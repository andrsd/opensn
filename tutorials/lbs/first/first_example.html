<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A First Example with Orthogonal Grids, KBA Partitioning, Vacuum BC, and Isotropic External Volumetric Source &mdash; openSn  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="BooleanLogicalVolume" href="../../../framework/boolean_logical_volume.html" />
    <link rel="prev" title="Mesh Tutorial 7: A 3D Extruded Mesh" href="../../3d_extruded_mesh.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            openSn
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install_linux.html">Compiling on Personal Linux Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install_macos.html">Compiling on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install_macos_easy.html">Easy install on MacOS Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install_ubuntu_easy.html">Easy install on Ubuntu Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start_install.html">Installation and Run Instructions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../basic_diffusion_simulation.html">Tutorial 1: Basic Diffusion Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../output.html">Tutorial 2: Other Forms of Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basic_transport_simulation.html">Tutorial 3: Basic Transport Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../1d_mesh.html">Mesh Tutorial 1: Simple 1D Meshes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../2d_ortho_mesh.html">Mesh Tutorial 2: A 2D Orthogonal Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../3d_ortho_mesh.html">Mesh Tutorial 3: A 3D Orthogonal Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../predef_2d.html">Mesh Tutorial 4: Predefined 2D Mesh Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gmsh_tutorial.html">Mesh Tutorial 5: Example using gmsh to create a structured mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../2d_triangle_python.html">Mesh Tutorial 6: A 2D Unstructured Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../3d_extruded_mesh.html">Mesh Tutorial 7: A 3D Extruded Mesh</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">A First Example with Orthogonal Grids, KBA Partitioning, Vacuum BC, and Isotropic External Volumetric Source</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#check-the-number-of-processes-requested">Check the number of processes requested</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mesh">Mesh</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#list-of-nodes">List of nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#orthogonal-mesh-generation">Orthogonal Mesh Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#material-ids">Material IDs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#materials">Materials</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cross-sections">Cross Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#volumetric-source">Volumetric Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#angular-quadrature">Angular Quadrature</a></li>
<li class="toctree-l2"><a class="reference internal" href="#linear-boltzmann-solver">Linear Boltzmann Solver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#options-for-the-linear-boltzmann-solver-lbs">Options for the Linear Boltzmann Solver (LBS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-options-for-the-linear-boltzmann-solver">Further Options for the Linear Boltzmann Solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#putting-the-linear-boltzmann-solver-together">Putting the Linear Boltzmann Solver Together</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#post-processing-via-field-functions">Post-Processing via Field Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#possible-extensions">Possible Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-complete-input-is-below">The complete input is below:</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../framework/boolean_logical_volume.html">BooleanLogicalVolume</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../start_source_code_doc.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start_developer_tutorials.html">Developer Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../start_user_tutorials.html">User Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">openSn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">A First Example with Orthogonal Grids, KBA Partitioning, Vacuum BC, and Isotropic External Volumetric Source</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="a-first-example-with-orthogonal-grids-kba-partitioning-vacuum-bc-and-isotropic-external-volumetric-source">
<h1>A First Example with Orthogonal Grids, KBA Partitioning, Vacuum BC, and Isotropic External Volumetric Source<a class="headerlink" href="#a-first-example-with-orthogonal-grids-kba-partitioning-vacuum-bc-and-isotropic-external-volumetric-source" title="Link to this heading"></a></h1>
<section id="check-the-number-of-processes-requested">
<h2>Check the number of processes requested<a class="headerlink" href="#check-the-number-of-processes-requested" title="Link to this heading"></a></h2>
<p>This is not mandatory, as a user may want to run the code with different numbers of processes. However,
this is often used in the many examples found in the regression suite, so we explain this practice early on:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">check_num_procs==nil</span></code> will be true when running serially without MPI</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">number_of_processes</span> <span class="pre">~=</span> <span class="pre">num_procs</span></code> will be true when the number of MPI processes requested is not equal to the preset value of <code class="docutils literal notranslate"><span class="pre">4</span></code>.</p></li>
</ul>
<p>To run the code, simply type: <code class="docutils literal notranslate"><span class="pre">mpiexec</span> <span class="pre">-n</span> <span class="pre">4</span> <span class="pre">*path/to*/opensn</span>&#160; <span class="pre">*input_filename*.lua</span></code></p>
<p>For more runtime options, type <code class="docutils literal notranslate"><span class="pre">*path/to*/opensn</span> <span class="pre">-h</span></code> for help.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="o">--</span> <span class="n">Check</span> <span class="n">num_procs</span>
<span class="n">num_procs</span> <span class="o">=</span> <span class="mi">4</span>
<span class="k">if</span> <span class="p">(</span><span class="n">check_num_procs</span><span class="o">==</span><span class="n">nil</span> <span class="ow">and</span> <span class="n">number_of_processes</span> <span class="o">~=</span> <span class="n">num_procs</span><span class="p">)</span> <span class="n">then</span>
  <span class="n">Log</span><span class="p">(</span><span class="n">LOG_0ERROR</span><span class="p">,</span><span class="s2">&quot;Incorrect amount of processors. &quot;</span> <span class="o">..</span>
    <span class="s2">&quot;Expected &quot;</span><span class="o">..</span><span class="n">tostring</span><span class="p">(</span><span class="n">num_procs</span><span class="p">)</span><span class="o">..</span>
    <span class="s2">&quot;. Pass check_num_procs=false to override if possible.&quot;</span><span class="p">)</span>
  <span class="n">os</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">false</span><span class="p">)</span>
<span class="n">end</span>

</pre></div>
</div>
</section>
<section id="mesh">
<h2>Mesh<a class="headerlink" href="#mesh" title="Link to this heading"></a></h2>
<p>Here, we will use the in-house mesh generator for a simple Cartesian grid.</p>
<section id="list-of-nodes">
<h3>List of nodes<a class="headerlink" href="#list-of-nodes" title="Link to this heading"></a></h3>
<p>We first create a lua table for the list of nodes.
Be mindful that lua indexing starts at 1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="o">--</span> <span class="n">Setup</span> <span class="n">mesh</span>
<span class="n">nodes</span><span class="o">=</span><span class="p">{}</span>
<span class="n">n_cells</span><span class="o">=</span><span class="mi">10</span>
<span class="n">length</span><span class="o">=</span><span class="mf">2.</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="mf">2.</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">length</span><span class="o">/</span><span class="n">n_cells</span>
<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,(</span><span class="n">n_cells</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="n">do</span>
    <span class="n">k</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">dx</span>
<span class="n">end</span>

</pre></div>
</div>
</section>
<section id="orthogonal-mesh-generation">
<h3>Orthogonal Mesh Generation<a class="headerlink" href="#orthogonal-mesh-generation" title="Link to this heading"></a></h3>
<p>We use the <code class="docutils literal notranslate"><span class="pre">OrthogonalMeshGenerator</span></code> and pass the list of nodes per dimension.
Here, we pass 2 times the same list of nodes to create a 2D geometry with square cells.</p>
<p>We also partition the 2D mesh into 2x2 subdomains using <code class="docutils literal notranslate"><span class="pre">KBAGraphPartitioner</span></code>.
Since we want the split the x-axis in 2, we give only 1 value in the xcuts array.
Likewise for ycuts.
The assignment to a partition is done based on where the cell center is located with respect to the various xcuts, ycuts, and zcuts (a fuzzy logic is applied to avoid issues).</p>
<p>The resulting mesh and partition is shown below:</p>
<p><img alt="Mesh_Partition" src="../../../_images/first_example_mesh_partition.png" /></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">meshgen</span> <span class="o">=</span> <span class="n">chi_mesh</span><span class="o">.</span><span class="n">OrthogonalMeshGenerator</span><span class="o">.</span><span class="n">Create</span>
<span class="p">({</span>
  <span class="n">node_sets</span> <span class="o">=</span> <span class="p">{</span><span class="n">nodes</span><span class="p">,</span><span class="n">nodes</span><span class="p">},</span>
  <span class="n">partitioner</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">KBAGraphPartitioner</span><span class="o">.</span><span class="n">Create</span>
  <span class="p">({</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">xcuts</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">},</span> <span class="n">ycuts</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">},</span>
  <span class="p">})</span>
<span class="p">})</span>

<span class="n">chi_mesh</span><span class="o">.</span><span class="n">MeshGenerator</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">meshgen</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="material-ids">
<h3>Material IDs<a class="headerlink" href="#material-ids" title="Link to this heading"></a></h3>
<p>We create a right parallelepiped logical volume that contains the entire mesh and we assign a 0 for material ID to all cells found inside the logical volume. Logical volumes are quite powerful, see subsequent tutorials on meshing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="o">--</span> <span class="n">Set</span> <span class="n">Material</span> <span class="n">IDs</span>
<span class="n">vol0</span> <span class="o">=</span> <span class="n">chi_mesh</span><span class="o">.</span><span class="n">RPPLogicalVolume</span><span class="o">.</span><span class="n">Create</span><span class="p">({</span><span class="n">infx</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">infy</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">infz</span><span class="o">=</span><span class="n">true</span><span class="p">})</span>
<span class="n">chiVolumeMesherSetProperty</span><span class="p">(</span><span class="n">MATID_FROMLOGICAL</span><span class="p">,</span><span class="n">vol0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
<section id="materials">
<h2>Materials<a class="headerlink" href="#materials" title="Link to this heading"></a></h2>
<p>We create a material and add two properties to it:</p>
<ul class="simple">
<li><p>TRANSPORT_XSECTIONS for the transport cross sections, and</p></li>
<li><p>ISOTROPIC_MG_SOURCE for the isotropic volumetric source</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="o">--</span> <span class="n">Add</span> <span class="n">materials</span>
<span class="n">materials</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">chiPhysicsAddMaterial</span><span class="p">(</span><span class="s2">&quot;Material_A&quot;</span><span class="p">);</span>

<span class="n">chiPhysicsMaterialAddProperty</span><span class="p">(</span><span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">TRANSPORT_XSECTIONS</span><span class="p">)</span>
<span class="n">chiPhysicsMaterialAddProperty</span><span class="p">(</span><span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ISOTROPIC_MG_SOURCE</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="cross-sections">
<h2>Cross Sections<a class="headerlink" href="#cross-sections" title="Link to this heading"></a></h2>
<p>We assign the cross sections to the material by loading the file containing the cross sections.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">chiPhysicsMaterialSetProperty</span><span class="p">(</span><span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">TRANSPORT_XSECTIONS</span><span class="p">,</span>
  <span class="n">CHI_XSFILE</span><span class="p">,</span><span class="s2">&quot;xs_1g_MatA.cxs&quot;</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="volumetric-source">
<h2>Volumetric Source<a class="headerlink" href="#volumetric-source" title="Link to this heading"></a></h2>
<p>We create a lua table containing the volumetric multigroup source and assign it to the material by passing that array.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num_groups</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">src</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">g</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">num_groups</span> <span class="n">do</span>
  <span class="n">src</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">end</span>
<span class="n">chiPhysicsMaterialSetProperty</span><span class="p">(</span><span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ISOTROPIC_MG_SOURCE</span><span class="p">,</span><span class="n">FROM_ARRAY</span><span class="p">,</span><span class="n">src</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="angular-quadrature">
<h2>Angular Quadrature<a class="headerlink" href="#angular-quadrature" title="Link to this heading"></a></h2>
<p>We call a product Gauss-Legendre-Chebyshev quadrature and pass the number of <strong>positive</strong> polar cosines (here <code class="docutils literal notranslate"><span class="pre">npolar</span> <span class="pre">=</span> <span class="pre">2</span></code>) and the number of azimuthal subdivisions in <strong>one quadrant</strong> (<code class="docutils literal notranslate"><span class="pre">nazimu</span> <span class="pre">=</span> <span class="pre">1</span></code>). This creates a 3D angular quadrature.</p>
<p>We finish by optimizing the quadrature to only use the positive hemisphere for 2D simulations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Setup</span> <span class="n">the</span> <span class="n">Angular</span> <span class="n">Quadrature</span>
<span class="n">nazimu</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">npolar</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">pquad</span> <span class="o">=</span> <span class="n">chiCreateProductQuadrature</span><span class="p">(</span><span class="n">GAUSS_LEGENDRE_CHEBYSHEV</span><span class="p">,</span><span class="n">nazimu</span><span class="p">,</span><span class="n">npolar</span><span class="p">)</span>
<span class="n">chiOptimizeAngularQuadratureForPolarSymmetry</span><span class="p">(</span><span class="n">pquad</span><span class="p">,</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="linear-boltzmann-solver">
<h2>Linear Boltzmann Solver<a class="headerlink" href="#linear-boltzmann-solver" title="Link to this heading"></a></h2>
<section id="options-for-the-linear-boltzmann-solver-lbs">
<h3>Options for the Linear Boltzmann Solver (LBS)<a class="headerlink" href="#options-for-the-linear-boltzmann-solver-lbs" title="Link to this heading"></a></h3>
<p>In the LBS block, we provide</p>
<ul class="simple">
<li><p>the number of energy groups,</p></li>
<li><p>the groupsets (with 0-indexing), the handle for the angular quadrature, the angle aggregation, the solver type, tolerances, and other solver options.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Setup</span> <span class="n">LBS</span> <span class="n">parameters</span>
<span class="n">lbs_block</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="n">num_groups</span> <span class="o">=</span> <span class="n">num_groups</span><span class="p">,</span>
  <span class="n">groupsets</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="p">{</span>
      <span class="n">groups_from_to</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
      <span class="n">angular_quadrature_handle</span> <span class="o">=</span> <span class="n">pquad</span><span class="p">,</span>
      <span class="n">angle_aggregation_num_subsets</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
      <span class="n">inner_linear_method</span> <span class="o">=</span> <span class="s2">&quot;gmres&quot;</span><span class="p">,</span>
      <span class="n">l_abs_tol</span> <span class="o">=</span> <span class="mf">1.0e-6</span><span class="p">,</span>
      <span class="n">l_max_its</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
      <span class="n">gmres_restart_interval</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="further-options-for-the-linear-boltzmann-solver">
<h3>Further Options for the Linear Boltzmann Solver<a class="headerlink" href="#further-options-for-the-linear-boltzmann-solver" title="Link to this heading"></a></h3>
<p>In the LBS options, we pass the maximum scattering order to be employed (should be less than the one supplied the cross section file)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lbs_options</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="n">scattering_order</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="putting-the-linear-boltzmann-solver-together">
<h3>Putting the Linear Boltzmann Solver Together<a class="headerlink" href="#putting-the-linear-boltzmann-solver-together" title="Link to this heading"></a></h3>
<p>We then create the physics solver, initialize it, and execute it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phys</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">DiscreteOrdinatesSolver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">lbs_block</span><span class="p">)</span>
<span class="n">lbs</span><span class="o">.</span><span class="n">SetOptions</span><span class="p">(</span><span class="n">phys</span><span class="p">,</span> <span class="n">lbs_options</span><span class="p">)</span>

<span class="n">ss_solver</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">SteadyStateSolver</span><span class="o">.</span><span class="n">Create</span><span class="p">({</span><span class="n">lbs_solver_handle</span> <span class="o">=</span> <span class="n">phys</span><span class="p">})</span>

<span class="n">chiSolverInitialize</span><span class="p">(</span><span class="n">ss_solver</span><span class="p">)</span>
<span class="n">chiSolverExecute</span><span class="p">(</span><span class="n">ss_solver</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
<section id="post-processing-via-field-functions">
<h2>Post-Processing via Field Functions<a class="headerlink" href="#post-processing-via-field-functions" title="Link to this heading"></a></h2>
<p>We extract the scalar flux (i.e., the first entry in the field function list; recall that lua indexing starts at 1) and export it to a VTK file whose name is supplied by the user.</p>
<p>The resulting scalar flux is shown below:</p>
<p><img alt="Scalar_flux" src="../../../_images/first_example_scalar_flux.png" /></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fflist</span><span class="p">,</span><span class="n">count</span> <span class="o">=</span> <span class="n">chiLBSGetScalarFieldFunctionList</span><span class="p">(</span><span class="n">phys</span><span class="p">)</span>
<span class="n">vtk_basename</span> <span class="o">=</span> <span class="s2">&quot;first_example&quot;</span>
<span class="n">chiExportFieldFunctionToVTK</span><span class="p">(</span><span class="n">fflist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">vtk_basename</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="possible-extensions">
<h2>Possible Extensions<a class="headerlink" href="#possible-extensions" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Change the number of MPI processes (you may want to delete the safeguard at the top of the input file to run with any number of MPI ranks);</p></li>
<li><p>Change the spatial resolution by increasing or decreasing the number of cells;</p></li>
<li><p>Change the angular resolution by increasing or decreasing the number of polar and azimuthal subdivisions.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="the-complete-input-is-below">
<h2>The complete input is below:<a class="headerlink" href="#the-complete-input-is-below" title="Link to this heading"></a></h2>
<p>You can copy/paste the text below or look in the file named <code class="docutils literal notranslate"><span class="pre">/Users/andrsd/devel/openSn/doc/tutorials/lbs/first/first_example.lua</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="o">--</span> <span class="n">Check</span> <span class="n">num_procs</span>
<span class="n">num_procs</span> <span class="o">=</span> <span class="mi">4</span>
<span class="k">if</span> <span class="p">(</span><span class="n">check_num_procs</span><span class="o">==</span><span class="n">nil</span> <span class="ow">and</span> <span class="n">number_of_processes</span> <span class="o">~=</span> <span class="n">num_procs</span><span class="p">)</span> <span class="n">then</span>
  <span class="n">Log</span><span class="p">(</span><span class="n">LOG_0ERROR</span><span class="p">,</span><span class="s2">&quot;Incorrect amount of processors. &quot;</span> <span class="o">..</span>
    <span class="s2">&quot;Expected &quot;</span><span class="o">..</span><span class="n">tostring</span><span class="p">(</span><span class="n">num_procs</span><span class="p">)</span><span class="o">..</span>
    <span class="s2">&quot;. Pass check_num_procs=false to override if possible.&quot;</span><span class="p">)</span>
  <span class="n">os</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">false</span><span class="p">)</span>
<span class="n">end</span>


<span class="o">--</span> <span class="n">Setup</span> <span class="n">mesh</span>
<span class="n">nodes</span><span class="o">=</span><span class="p">{}</span>
<span class="n">n_cells</span><span class="o">=</span><span class="mi">10</span>
<span class="n">length</span><span class="o">=</span><span class="mf">2.</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">length</span><span class="o">/</span><span class="mf">2.</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">length</span><span class="o">/</span><span class="n">n_cells</span>
<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,(</span><span class="n">n_cells</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="n">do</span>
    <span class="n">k</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">dx</span>
<span class="n">end</span>

<span class="n">meshgen</span> <span class="o">=</span> <span class="n">chi_mesh</span><span class="o">.</span><span class="n">OrthogonalMeshGenerator</span><span class="o">.</span><span class="n">Create</span>
<span class="p">({</span>
  <span class="n">node_sets</span> <span class="o">=</span> <span class="p">{</span><span class="n">nodes</span><span class="p">,</span><span class="n">nodes</span><span class="p">},</span>
  <span class="n">partitioner</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">KBAGraphPartitioner</span><span class="o">.</span><span class="n">Create</span>
  <span class="p">({</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">xcuts</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">},</span> <span class="n">ycuts</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">},</span>
  <span class="p">})</span>
<span class="p">})</span>

<span class="n">chi_mesh</span><span class="o">.</span><span class="n">MeshGenerator</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">meshgen</span><span class="p">)</span>


<span class="o">--</span> <span class="n">Set</span> <span class="n">Material</span> <span class="n">IDs</span>
<span class="n">vol0</span> <span class="o">=</span> <span class="n">chi_mesh</span><span class="o">.</span><span class="n">RPPLogicalVolume</span><span class="o">.</span><span class="n">Create</span><span class="p">({</span><span class="n">infx</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">infy</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">infz</span><span class="o">=</span><span class="n">true</span><span class="p">})</span>
<span class="n">chiVolumeMesherSetProperty</span><span class="p">(</span><span class="n">MATID_FROMLOGICAL</span><span class="p">,</span><span class="n">vol0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>


<span class="o">--</span> <span class="n">Add</span> <span class="n">materials</span>
<span class="n">materials</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">chiPhysicsAddMaterial</span><span class="p">(</span><span class="s2">&quot;Material_A&quot;</span><span class="p">);</span>

<span class="n">chiPhysicsMaterialAddProperty</span><span class="p">(</span><span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">TRANSPORT_XSECTIONS</span><span class="p">)</span>
<span class="n">chiPhysicsMaterialAddProperty</span><span class="p">(</span><span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ISOTROPIC_MG_SOURCE</span><span class="p">)</span>


<span class="n">chiPhysicsMaterialSetProperty</span><span class="p">(</span><span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">TRANSPORT_XSECTIONS</span><span class="p">,</span>
  <span class="n">CHI_XSFILE</span><span class="p">,</span><span class="s2">&quot;xs_1g_MatA.cxs&quot;</span><span class="p">)</span>

<span class="n">num_groups</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">src</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">g</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">num_groups</span> <span class="n">do</span>
  <span class="n">src</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">end</span>
<span class="n">chiPhysicsMaterialSetProperty</span><span class="p">(</span><span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ISOTROPIC_MG_SOURCE</span><span class="p">,</span><span class="n">FROM_ARRAY</span><span class="p">,</span><span class="n">src</span><span class="p">)</span>

<span class="o">--</span> <span class="n">Setup</span> <span class="n">the</span> <span class="n">Angular</span> <span class="n">Quadrature</span>
<span class="n">nazimu</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">npolar</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">pquad</span> <span class="o">=</span> <span class="n">chiCreateProductQuadrature</span><span class="p">(</span><span class="n">GAUSS_LEGENDRE_CHEBYSHEV</span><span class="p">,</span><span class="n">nazimu</span><span class="p">,</span><span class="n">npolar</span><span class="p">)</span>
<span class="n">chiOptimizeAngularQuadratureForPolarSymmetry</span><span class="p">(</span><span class="n">pquad</span><span class="p">,</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="o">--</span> <span class="n">Setup</span> <span class="n">LBS</span> <span class="n">parameters</span>
<span class="n">lbs_block</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="n">num_groups</span> <span class="o">=</span> <span class="n">num_groups</span><span class="p">,</span>
  <span class="n">groupsets</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="p">{</span>
      <span class="n">groups_from_to</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
      <span class="n">angular_quadrature_handle</span> <span class="o">=</span> <span class="n">pquad</span><span class="p">,</span>
      <span class="n">angle_aggregation_num_subsets</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
      <span class="n">inner_linear_method</span> <span class="o">=</span> <span class="s2">&quot;gmres&quot;</span><span class="p">,</span>
      <span class="n">l_abs_tol</span> <span class="o">=</span> <span class="mf">1.0e-6</span><span class="p">,</span>
      <span class="n">l_max_its</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
      <span class="n">gmres_restart_interval</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">lbs_options</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="n">scattering_order</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">phys</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">DiscreteOrdinatesSolver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">lbs_block</span><span class="p">)</span>
<span class="n">lbs</span><span class="o">.</span><span class="n">SetOptions</span><span class="p">(</span><span class="n">phys</span><span class="p">,</span> <span class="n">lbs_options</span><span class="p">)</span>

<span class="o">--</span><span class="c1">############################################### Initialize and Execute Solver</span>
<span class="n">ss_solver</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">SteadyStateSolver</span><span class="o">.</span><span class="n">Create</span><span class="p">({</span><span class="n">lbs_solver_handle</span> <span class="o">=</span> <span class="n">phys</span><span class="p">})</span>

<span class="n">chiSolverInitialize</span><span class="p">(</span><span class="n">ss_solver</span><span class="p">)</span>
<span class="n">chiSolverExecute</span><span class="p">(</span><span class="n">ss_solver</span><span class="p">)</span>

<span class="o">--</span><span class="c1">############################################### Get field functions</span>
<span class="n">fflist</span><span class="p">,</span><span class="n">count</span> <span class="o">=</span> <span class="n">chiLBSGetScalarFieldFunctionList</span><span class="p">(</span><span class="n">phys</span><span class="p">)</span>
<span class="n">vtk_basename</span> <span class="o">=</span> <span class="s2">&quot;first_example&quot;</span>
<span class="n">chiExportFieldFunctionToVTK</span><span class="p">(</span><span class="n">fflist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">vtk_basename</span><span class="p">)</span>

</pre></div>
</div>
<p>Back to \ref lbs_tutorials</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../3d_extruded_mesh.html" class="btn btn-neutral float-left" title="Mesh Tutorial 7: A 3D Extruded Mesh" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../framework/boolean_logical_volume.html" class="btn btn-neutral float-right" title="BooleanLogicalVolume" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-present, openSn team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>